{% extends "layout.html" %}
{% block title %}Book Appointment | MrigaAayuvets{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative h-64 md:h-80 flex items-center justify-center bg-gradient-to-r from-green-500 via-green-400 to-green-600 text-white">
  <div class="text-center">
    <h1 class="text-3xl md:text-5xl font-extrabold drop-shadow-lg">Book Appointment</h1>
    <p class="mt-3 text-lg font-medium text-green-100">We're here to care for your pets 24/7 🐾</p>
  </div>
</section>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="max-w-7xl mx-auto px-6 pt-6">
      {% for category, message in messages %}
        <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} mb-4 p-4 rounded-lg
                    {{ 'bg-green-100 border border-green-400 text-green-700' if category == 'success' else 'bg-red-100 border border-red-400 text-red-700' }}">
          <div class="flex items-center">
            <span class="mr-2">
              {% if category == 'success' %}✅{% else %}❌{% endif %}
            </span>
            {{ message }}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Appointment Info + Form -->
<main class="max-w-7xl mx-auto px-6 py-16">
  <div class="text-center mb-12">
    <h2 class="text-4xl font-extrabold text-gray-800 mb-4 animate-bounce">Schedule Your Appointment</h2>
    <p class="text-lg text-gray-600">Fill out the form below and we'll confirm your slot via WhatsApp 📲</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-10">
    
    <!-- Info Section -->
    <div class="bg-white shadow-lg rounded-2xl p-6 sm:p-8 space-y-6 hover:shadow-2xl transition duration-500">
      <h3 class="text-xl sm:text-2xl font-bold text-green-600 mb-4">Why Book With Us?</h3>
      <p class="text-gray-600 text-sm sm:text-base">We provide trusted veterinary services at your doorstep. Booking online helps us serve your pets faster and better.</p>
      <ul class="space-y-3 text-gray-700 text-sm sm:text-base">
        <li>✅ Stress-free home visits</li>
        <li>✅ 24/7 emergency support</li>
        <li>✅ Personalized nutrition & care</li>
        <li>✅ Experienced veterinarians</li>
        <li>✅ Modern equipment & medicines</li>
      </ul>

      <!-- Services List -->
      <div class="mt-8">
        <h4 class="text-lg font-semibold text-gray-800 mb-3">Our Services:</h4>
        <div class="grid grid-cols-2 gap-2 text-xs sm:text-sm text-gray-600">
          <div>• Vaccination</div>
          <div>• General Treatment</div>
          <div>• Deworming</div>
          <div>• Pet Grooming</div>
          <div>• Nail Trimming</div>
          <div>• Dental Care</div>
          <div>• X-Ray Services</div>
          <div>• Emergency Care</div>
        </div>
      </div>

      <!-- Contact Us Now -->
      <div class="text-center mt-8 lg:mt-12 xl:mt-16">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3">Need Immediate Care?</h3>
        <p class="text-gray-600 mb-5 text-sm sm:text-base">Contact us now for emergency veterinary services at your doorstep</p>
        <a href="https://wa.me/918208657969?text=Hello%20Doctor,%20I%20need%20emergency%20veterinary%20services%20for%20my%20pet.%20Please%20help."
           target="_blank"
           class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 sm:px-6 rounded-lg shadow-lg transition duration-300 transform hover:scale-105 inline-block text-sm sm:text-base">
          📞 Emergency Contact
        </a>
      </div>
    </div>

    <!-- Appointment Form -->
    <div class="bg-white shadow-lg rounded-2xl p-6 sm:p-8 hover:shadow-2xl transition duration-500">
      <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 text-center">Book Your Appointment</h3>
      
      <form method="POST" action="{{ url_for('appointment') }}" id="appointmentForm" class="space-y-4 sm:space-y-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="name" class="block text-gray-700 font-semibold text-sm">Your Name *</label>
            <input type="text" id="name" name="name" required
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base">
          </div>

          <div>
            <label for="email" class="block text-gray-700 font-semibold text-sm">Email *</label>
            <input type="email" id="email" name="email" required
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base">
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="phone" class="block text-gray-700 font-semibold text-sm">Phone Number *</label>
            <input type="tel" id="phone" name="phone" required pattern="[0-9]{10}"
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base"
              placeholder="10-digit mobile number">
          </div>

          <div>
            <label for="pet_name" class="block text-gray-700 font-semibold text-sm">Pet's Name</label>
            <input type="text" id="pet_name" name="pet_name"
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base">
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="service" class="block text-gray-700 font-semibold text-sm">Service Required</label>
            <select id="service" name="service"
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base">
              <option value="">Select Service</option>
              <option value="Vaccination">🩹 Vaccination</option>
              <option value="General Treatment">⚕️ General Treatment</option>
              <option value="Deworming">💊 Deworming</option>
              <option value="Grooming">✂️ Pet Grooming</option>
              <option value="Nail Trimming">💅 Nail Trimming</option>
              <option value="Dental Care">🦷 Dental Care</option>
              <option value="X-Ray">📸 X-Ray Services</option>
              <option value="Emergency Care">🚨 Emergency Care</option>
              <option value="Nutrition Consultation">🥗 Nutrition Consultation</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div>
            <label for="pet_type" class="block text-gray-700 font-semibold text-sm">Pet Type</label>
            <select id="pet_type" name="pet_type"
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base">
              <option value="">Select Type</option>
              <option value="Dog">🐕 Dog</option>
              <option value="Cat">🐈 Cat</option>
              <option value="Bird">🐦 Bird</option>
              <option value="Rabbit">🐰 Rabbit</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="preferred_date" class="block text-gray-700 font-semibold text-sm">Preferred Date</label>
            <input type="date" id="preferred_date" name="preferred_date"
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base">
          </div>

          <div>
            <label for="preferred_time" class="block text-gray-700 font-semibold text-sm">Preferred Time</label>
            <select id="preferred_time" name="preferred_time"
              class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base">
              <option value="">Select Time</option>
              <option value="09:00">9:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="12:00">12:00 PM</option>
              <option value="14:00">2:00 PM</option>
              <option value="15:00">3:00 PM</option>
              <option value="16:00">4:00 PM</option>
              <option value="17:00">5:00 PM</option>
              <option value="18:00">6:00 PM</option>
              <option value="19:00">7:00 PM</option>
            </select>
          </div>
        </div>

        <div>
          <label for="message" class="block text-gray-700 font-semibold text-sm">Additional Message / Symptoms Details</label>
          <textarea id="message" name="message" rows="3"
            class="w-full mt-1 sm:mt-2 p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base"
            placeholder="Please describe your pet's condition in detail..."></textarea>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <button type="submit" name="action" value="database"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 sm:py-3 px-4 sm:px-6 rounded-lg shadow-lg transition duration-300 transform hover:scale-105 text-sm sm:text-base">
            📋 Confirm Appointment
          </button>
          
          <button type="button" id="whatsappBtn"
            class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 sm:py-3 px-4 sm:px-6 rounded-lg shadow-lg transition duration-300 transform hover:scale-105 text-sm sm:text-base">
            📱 Book via WhatsApp
          </button>
        </div>
      </form>
    </div>
  </div>
</main>

<!-- Mobile Optimization Styles -->
<style>
  /* Mobile-specific optimizations */
  @media (max-width: 640px) {
    .max-w-7xl {
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    .grid.gap-8 {
      gap: 1.5rem;
    }
    
    .space-y-6 > * + * {
      margin-top: 1rem;
    }
    
    .space-y-4 > * + * {
      margin-top: 0.75rem;
    }
    
    /* Ensure form inputs are properly sized on mobile */
    input[type="text"],
    input[type="email"], 
    input[type="tel"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      font-size: 16px; /* Prevents zoom on iOS */
      -webkit-appearance: none;
      appearance: none;
    }
    
    /* Better button spacing on mobile */
    .grid.grid-cols-1.sm\\:grid-cols-2 {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }
    
    /* Adjust hero section height */
    .h-64.md\\:h-80 {
      height: 200px;
    }
    
    /* Reduce animation bounce on mobile for performance */
    .animate-bounce {
      animation: none;
    }
  }
  
  /* Tablet optimizations */
  @media (min-width: 641px) and (max-width: 1024px) {
    .grid.grid-cols-1.lg\\:grid-cols-2 {
      gap: 2rem;
    }
  }
  
  /* Loading state for buttons */
  .btn-loading {
    opacity: 0.7;
    pointer-events: none;
  }
  
  .btn-loading::after {
    content: "...";
    animation: dots 1.5s steps(5, end) infinite;
  }
  
  @keyframes dots {
    0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
    40% { color: white; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
    60% { text-shadow: .25em 0 0 white, .5em 0 0 rgba(0,0,0,0); }
    80%, 100% { text-shadow: .25em 0 0 white, .5em 0 0 white; }
  }
</style>

<!-- Enhanced JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const appointmentForm = document.getElementById("appointmentForm");
    const whatsappBtn = document.getElementById("whatsappBtn");
    const submitBtn = document.querySelector('button[name="action"][value="database"]');
    
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('preferred_date').setAttribute('min', today);
    
    // WhatsApp button functionality
    whatsappBtn.addEventListener("click", function() {
        if (!validateForm()) {
            alert('Please fill in all required fields before sending to WhatsApp.');
            return;
        }
        
        sendToWhatsApp();
    });
    
    // Form submission for database
    appointmentForm.addEventListener("submit", function(e) {
        if (e.submitter && e.submitter.name === 'action' && e.submitter.value === 'database') {
            // Let the form submit normally to Flask backend
            if (!validateForm()) {
                e.preventDefault();
                alert('Please fill in all required fields.');
                return;
            }
            
            // Add loading state
            submitBtn.classList.add('btn-loading');
            submitBtn.textContent = 'Submitting';
        }
    });
    
    function validateForm() {
        const requiredFields = ['name', 'email', 'phone'];
        let isValid = true;
        
        requiredFields.forEach(field => {
            const input = document.getElementById(field);
            if (!input.value.trim()) {
                input.classList.add('border-red-500');
                isValid = false;
            } else {
                input.classList.remove('border-red-500');
            }
        });
        
        // Validate phone number
        const phone = document.getElementById('phone').value;
        if (phone && !/^[0-9]{10}$/.test(phone)) {
            document.getElementById('phone').classList.add('border-red-500');
            isValid = false;
        }
        
        // Validate email
        const email = document.getElementById('email').value;
        if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            document.getElementById('email').classList.add('border-red-500');
            isValid = false;
        }
        
        return isValid;
    }
    
    function sendToWhatsApp() {
        const formData = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value,
            petName: document.getElementById("pet_name").value || "Not specified",
            petType: document.getElementById("pet_type").value || "Not specified",
            service: document.getElementById("service").value || "General consultation",
            preferredDate: document.getElementById("preferred_date").value || "ASAP",
            preferredTime: document.getElementById("preferred_time").value || "Flexible",
            message: document.getElementById("message").value || "No additional message"
        };
        
        let whatsappMessage = `🐾 *New Appointment Request* 🐾%0A%0A
👤 *Patient Details:*%0A
Name: ${formData.name}%0A
Email: ${formData.email}%0A
Phone: ${formData.phone}%0A%0A
🐕 *Pet Details:*%0A
Pet Name: ${formData.petName}%0A
Pet Type: ${formData.petType}%0A%0A
⚕️ *Service Required:*%0A
${formData.service}%0A%0A
📅 *Preferred Schedule:*%0A
Date: ${formData.preferredDate}%0A
Time: ${formData.preferredTime}%0A%0A
📝 *Additional Information:*%0A
${formData.message}%0A%0A
Thank you for choosing MrigaAayuvets! 🙏`;

        // Doctor's WhatsApp number
        const phone = "918208657969";
        
        // Add loading state to WhatsApp button
        whatsappBtn.classList.add('btn-loading');
        whatsappBtn.textContent = 'Opening WhatsApp';
        
        // Open WhatsApp with pre-filled message
        window.open(`https://wa.me/${phone}?text=${whatsappMessage}`, "_blank");
        
        // Remove loading state after a delay
        setTimeout(() => {
            whatsappBtn.classList.remove('btn-loading');
            whatsappBtn.innerHTML = '📱 Book via WhatsApp';
        }, 2000);
    }
    
    // Remove error styling on input
    document.querySelectorAll('input, select, textarea').forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('border-red-500');
        });
    });
    
    // Auto-format phone number
    document.getElementById('phone').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 10) {
            value = value.slice(0, 10);
        }
        e.target.value = value;
    });
});
</script>
{% endblock %}