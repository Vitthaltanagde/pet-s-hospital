from flask import Response, url_for
from datetime import datetime

@app.route('/sitemap.xml', methods=['GET'])
def sitemap():
    pages = []

    # Static pages
    static_pages = ['index', 'about', 'contact', 'appointment', 'services', 'blogs', 'gallery']
    for page in static_pages:
        url = url_for(page, _external=True)
        pages.append(f"""
        <url>
            <loc>{url}</loc>
            <lastmod>{datetime.today().date()}</lastmod>
            <changefreq>weekly</changefreq>
            <priority>0.9</priority>
        </url>
        """)

    # Dynamic service pages
    for service_id in services_data.keys():
        url = url_for('service_detail', service_id=service_id, _external=True)
        pages.append(f"""
        <url>
            <loc>{url}</loc>
            <lastmod>{datetime.today().date()}</lastmod>
            <changefreq>weekly</changefreq>
            <priority>0.8</priority>
        </url>
        """)

    # Dynamic blog pages
    for blog_id in blogs_data.keys():
        url = url_for('blog_detail', blog_id=blog_id, _external=True)
        pages.append(f"""
        <url>
            <loc>{url}</loc>
            <lastmod>{datetime.today().date()}</lastmod>
            <changefreq>weekly</changefreq>
            <priority>0.8</priority>
        </url>
        """)

    sitemap_xml = f"""<?xml version="1.0" encoding="UTF-8"?>
    <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
        {''.join(pages)}
    </urlset>
    """
    return Response(sitemap_xml, mimetype='application/xml')

